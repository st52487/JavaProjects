package gui;

import alert.ChybovaHlaska;
import seznam.Adapter;
import automobily.Automobil;
import automobily.BarvaAuta;
import automobily.Dodavka;
import automobily.NakladniAutomobil;
import automobily.OsobniAutomobil;
import automobily.TypAutomobilu;
import javafx.scene.Scene;
import javafx.scene.control.ComboBox;
import javafx.scene.layout.GridPane;
import javafx.stage.Stage;
import kolekce.KolekceException;
import static gui.Komponenty.*;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.Button;
import javafx.scene.control.CheckBox;
import javafx.scene.control.TextField;
import javafx.scene.layout.VBox;

public class DialogNovy_Zmenit extends Stage {

    private GridPane grid;
    private final Adapter adapter;
    private final Automobil automobily;
    private ComboBox<TypAutomobilu> cbTypAutomobilu;
    private TextField tfPocetKol;
    private ComboBox<BarvaAuta> cbBarvaAuta;
    private TextField tfCtvrtyParametr;
    private TextField tfPatyParametr;
    private CheckBox cbPatyParametr;
    private Button btOK;

    public DialogNovy_Zmenit(Adapter adapter, Automobil automobily) {
        this.adapter = adapter;
        this.automobily = automobily;
        vytvorDialog();
    }

    private void vytvorDialog() {
        VBox box = new VBox();
        box.setAlignment(Pos.CENTER);
        grid = new GridPane();
        grid.setAlignment(Pos.CENTER);
        grid.setPadding(new Insets(10));
        grid.setHgap(10);
        grid.setVgap(10);

        vytvor();

        btOK = addButton("OK", (event) -> {
            buttonOKAction();
        });

        box.getChildren().addAll(grid, btOK);

        setTitle("Nový automobil");
        Scene scene = new Scene(box, 400, 250);
        setResizable(false);
        setScene(scene);
        showAndWait();
    }

    private void buttonOKAction() {
        if (automobily != null) {
            nastavTyp();
        } else {
            try {
                pridejAuto();
            } catch (KolekceException | NumberFormatException ex) {
                ChybovaHlaska.zobrazAlert("Nepodařilo se vytvořit auto!");
                return;
            }
        }
        close();
    }

    private void pridejAuto() throws KolekceException {
        if (null != cbTypAutomobilu.getSelectionModel().getSelectedItem()) {
            switch (cbTypAutomobilu.getSelectionModel().getSelectedItem()) {
                case OSOBNI:
                    osobniPridej();
                    break;
                case DODAVKA:
                    dodavkaPridej();
                    break;
                case NAKLADNI:
                    nakladniPridej();
                    break;
            }
        }
    }

    private void osobniPridej() throws KolekceException {
        adapter.clickPridejOsobni(TypAutomobilu.OSOBNI,
                Integer.parseInt(tfPocetKol.getText()),
                cbBarvaAuta.getSelectionModel().getSelectedItem(),
                tfCtvrtyParametr.getText(),
                Boolean.parseBoolean(cbPatyParametr.getText()));
    }

    private void dodavkaPridej() throws KolekceException {
        adapter.clickPridejDodavka(TypAutomobilu.DODAVKA,
                Integer.parseInt(tfPocetKol.getText()),
                cbBarvaAuta.getSelectionModel().getSelectedItem(),
                Integer.parseInt(tfCtvrtyParametr.getText()),
                tfPatyParametr.getText()
        );
    }

    private void nakladniPridej() throws KolekceException {
        adapter.clickPridejNakladni(TypAutomobilu.NAKLADNI,
                Integer.parseInt(tfPocetKol.getText()),
                cbBarvaAuta.getSelectionModel().getSelectedItem(),
                Integer.parseInt(tfCtvrtyParametr.getText()),
                Boolean.parseBoolean(cbPatyParametr.getText())
        );
    }

    private void nastavTyp() {
        switch (automobily.getTyp()) {
            case DODAVKA:
                caseDodavka();
                break;
            case NAKLADNI:
                caseNakladni();
                break;
            case OSOBNI:
                caseOsobni();
                break;
        }
    }

    private void caseOsobni() {
        automobily.setPocetKol(Integer.parseInt(tfPocetKol.getText()));
        ((OsobniAutomobil) automobily).setZnackaAuta(
                tfCtvrtyParametr.getText());
        automobily.setBarva(cbBarvaAuta.getSelectionModel().getSelectedItem());
        ((OsobniAutomobil) automobily).setFunkcni(cbPatyParametr
                .isSelected());
    }

    private void caseNakladni() {
        automobily.setPocetKol(Integer.parseInt(tfPocetKol.getText()));
        ((NakladniAutomobil) automobily).setPocetKoni(
                Integer.parseInt(tfCtvrtyParametr.getText()));
        automobily.setBarva(cbBarvaAuta.getSelectionModel().getSelectedItem());
        ((NakladniAutomobil) automobily).setNahonNaVsechny(
                cbPatyParametr.isSelected());
    }

    private void caseDodavka() {
        automobily.setPocetKol(Integer.parseInt(tfPocetKol.getText()));
        ((Dodavka) automobily).setHmotnost(Integer.parseInt(
                tfCtvrtyParametr.getText()));
        automobily.setBarva(cbBarvaAuta.getSelectionModel().getSelectedItem());
        ((Dodavka) automobily).setTypMotoru(tfPatyParametr.getText());
    }

    private void vytvor() {
        try {
            grid.getChildren().clear();

            TypAutomobilu typAutomobilu;
            if (automobily == null) {
                if (cbTypAutomobilu != null) {
                    typAutomobilu = cbTypAutomobilu.getSelectionModel()
                            .getSelectedItem();
                } else {
                    typAutomobilu = TypAutomobilu.DODAVKA;
                }
            } else {
                set();
                return;
            }

            cbTypAutomobilu = addRowComboBox(grid, "Typy automobilu: ", 0,
                    TypAutomobilu.values(), typAutomobilu, (event) -> vytvor());
            tfPocetKol = addRowTestField(grid, "Počet kol: ", 1);
            cbBarvaAuta = addRowComboBox(grid, "Barva: ", 2,
                    BarvaAuta.values());

            switch (typAutomobilu) {
                case OSOBNI:
                    tfCtvrtyParametr = addRowTestField(grid, "Značka: ", 3);
                    cbPatyParametr = addRowCheckBox(grid, "Funkční: ", 4, false);
                    break;
                case DODAVKA:
                    tfCtvrtyParametr = addRowTestField(grid, "Hmotnost: ", 3);
                    tfPatyParametr = addRowTestField(grid, "Typ motoru: ",
                            "turbo", 4);
                    break;
                case NAKLADNI:
                    tfCtvrtyParametr = addRowTestField(grid, "Počet koni: ", 3);
                    cbPatyParametr = addRowCheckBox(grid, "Nahon na všechny: ",
                            4, false);
                    break;
            }

        } catch (Exception e) {
            ChybovaHlaska.zobrazAlert("Nepodařilo se vytvořit dialog!");
        }
    }

    private void set() {

        grid.getChildren().clear();
        cbTypAutomobilu = addRowComboBox(grid, "Typy automobilu: ", 0,
                TypAutomobilu.values(), automobily.getTyp());
        tfPocetKol = addRowTestField(grid, "Počet kol: ",
                Integer.toString(automobily.getPocetKol()), 1);
        cbBarvaAuta = addRowComboBox(grid, "Barva: ", 2,
                BarvaAuta.values(), automobily.getBarva());

        switch (automobily.getTyp()) {
            case DODAVKA:
                tfCtvrtyParametr = addRowTestField(grid, "Hmotnost: ",
                        Integer.toString(((Dodavka) automobily).getHmotnost()),
                        3);
                tfPatyParametr = addRowTestField(grid, "Typ motoru: ",
                        ((Dodavka) automobily).getTypMotoru(), 4);
                break;
            case NAKLADNI:
                tfCtvrtyParametr = addRowTestField(grid, "Počet koni: ",
                        Integer.toString(((NakladniAutomobil) automobily).
                                getPocetKoni()), 3);
                cbPatyParametr = addRowCheckBox(grid, "Nahon na všechny: ", 4,
                        ((NakladniAutomobil) automobily).isNahonNaVsechny());
                break;
            case OSOBNI:
                tfCtvrtyParametr = addRowTestField(grid, "Značka: ",
                        ((OsobniAutomobil) automobily).getZnackaAuta(), 3);
                cbPatyParametr = addRowCheckBox(grid, "Funkční: ", 4,
                        ((OsobniAutomobil) automobily).isFunkcni());
                break;
        }
        cbTypAutomobilu.setDisable(true);
    }
}
